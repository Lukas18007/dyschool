{% extends 'core/base.html' %}

{% block title %}Dashboard do Professor - Dyschool{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Dashboard do Professor</h1>
        <p>Gerencie suas solicitações de aula e disponibilidade</p>
    </div>

    <div class="dashboard-grid">
        <!-- Profile Summary -->
        <div class="dashboard-card">
            <h3>Seu Perfil</h3>
            <div class="profile-summary">
                <p><strong>Valor por Hora:</strong> R$ {{ teacher_profile.hourly_rate }}</p>
                <p><strong>Experiência:</strong> {{ teacher_profile.experience_years }} anos</p>
                <p><strong>Especialidades:</strong></p>
                <div class="specialization-tags">
                    {% for specialization in teacher_profile.specializations.all %}
                        <span class="specialization-tag">{{ specialization.name }}</span>
                    {% endfor %}
                </div>
                <a href="{% url 'teacher_profile' %}" class="btn btn-secondary">Editar Perfil</a>
            </div>
        </div>

        <!-- Lesson Requests -->
        <div class="dashboard-card">
            <h3>Solicitações de Aula ({{ lesson_requests|length }})</h3>
            {% if lesson_requests %}
                <div class="requests-list">
                    {% for request in lesson_requests %}
                        <div class="request-item">
                            <div class="request-header">
                                <h4>{{ request.student.get_full_name }}</h4>
                                <span class="request-date">{{ request.created_at|date:"d/m/Y" }}</span>
                            </div>
                            <div class="request-details">
                                <p><strong>Tema:</strong> {{ request.lesson_topic.name }}</p>
                                <p><strong>Duração:</strong> {{ request.lesson_duration }} minutos</p>
                                <p><strong>Valor Máximo:</strong> R$ {{ request.max_hourly_rate }}</p>
                                {% if request.additional_notes %}
                                    <p><strong>Observações:</strong> {{ request.additional_notes|truncatewords:10 }}</p>
                                {% endif %}
                            </div>
                            <div class="request-actions">
                                <a href="{% url 'submit_availability' request.id %}" class="btn btn-primary">Enviar Disponibilidade</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="no-data">Nenhuma solicitação pendente</p>
            {% endif %}
        </div>

        <!-- My Availabilities -->
        <div class="dashboard-card">
            <h3>Minhas Disponibilidades ({{ availabilities|length }})</h3>
            {% if availabilities %}
                <div class="availabilities-list">
                    {% for availability in availabilities %}
                        <div class="availability-item {% if availability.is_accepted %}accepted{% endif %}">
                            <div class="availability-header">
                                <h4>{{ availability.lesson_request.student.get_full_name }}</h4>
                                <span class="availability-status">
                                    {% if availability.is_accepted %}
                                        <span class="status-accepted">Aceita</span>
                                    {% else %}
                                        <span class="status-pending">Pendente</span>
                                    {% endif %}
                                </span>
                            </div>
                            <div class="availability-details">
                                <p><strong>Data:</strong> {{ availability.available_date|date:"d/m/Y" }}</p>
                                <p><strong>Horário:</strong> {{ availability.available_time|time:"H:i" }}</p>
                                <p><strong>Duração:</strong> {{ availability.duration }} minutos</p>
                                <p><strong>Tema:</strong> {{ availability.lesson_request.lesson_topic.name }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="no-data">Nenhuma disponibilidade enviada</p>
            {% endif %}
        </div>

        <!-- Bookings -->
        <div class="dashboard-card">
            <h3>Aulas Confirmadas ({{ bookings|length }})</h3>
            {% if bookings %}
                <div class="bookings-list">
                    {% for booking in bookings %}
                        <div class="booking-item">
                            <div class="booking-header">
                                <h4>{{ booking.lesson_request.student.get_full_name }}</h4>
                                <span class="booking-status status-{{ booking.status }}">{{ booking.get_status_display }}</span>
                            </div>
                            <div class="booking-details">
                                <p><strong>Data:</strong> {{ booking.teacher_availability.available_date|date:"d/m/Y" }}</p>
                                <p><strong>Horário:</strong> {{ booking.teacher_availability.available_time|time:"H:i" }}</p>
                                <p><strong>Duração:</strong> {{ booking.teacher_availability.duration }} minutos</p>
                                <p><strong>Tema:</strong> {{ booking.lesson_request.lesson_topic.name }}</p>
                                <p><strong>Valor:</strong> R$ {{ teacher_profile.hourly_rate }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="no-data">Nenhuma aula confirmada</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %} 